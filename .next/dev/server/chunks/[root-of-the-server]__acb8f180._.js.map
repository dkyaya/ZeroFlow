{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/joachimjohnson/Documents/comp-sci/ZeroFlow/lib/prisma.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nlet prisma;\n\n// Prevent multiple Prisma instances in dev (Next.js hot reload)\nif (process.env.NODE_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!global.prisma) {\n    global.prisma = new PrismaClient();\n  }\n  prisma = global.prisma;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI;AAEJ,gEAAgE;AAChE;;KAEO;IACL,IAAI,CAAC,yDAAO,MAAM,EAAE;QAClB,yDAAO,MAAM,GAAG,IAAI,6IAAY;IAClC;IACA,SAAS,yDAAO,MAAM;AACxB"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/joachimjohnson/Documents/comp-sci/ZeroFlow/app/api/food/search/route.js"],"sourcesContent":["// app/api/food/search/route.js\n// USDA-backed search with graceful fallback when the DB is empty or unavailable.\n\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\n// Nutrient IDs in USDA FDC\n// These do NOT change across versions\nconst NUTRIENTS = {\n  calories: 1008,  // Energy (kcal)\n  protein: 1003,\n  carbs: 1005,\n  fat: 1004\n};\n\n// Lightweight fallback dataset so autocomplete still works if the DB is empty\nconst FALLBACK_FOODS = [\n  { fdcId: 1, name: \"Apple\", brandName: null, dataType: \"Generic\", macros: { calories: 95, protein: 0.5, carbs: 25, fat: 0.3 } },\n  { fdcId: 2, name: \"Banana\", brandName: null, dataType: \"Generic\", macros: { calories: 105, protein: 1.3, carbs: 27, fat: 0.4 } },\n  { fdcId: 3, name: \"Grilled Chicken Breast (100g)\", brandName: null, dataType: \"Generic\", macros: { calories: 165, protein: 31, carbs: 0, fat: 3.6 } },\n  { fdcId: 4, name: \"White Rice (1 cup cooked)\", brandName: null, dataType: \"Generic\", macros: { calories: 205, protein: 4.3, carbs: 45, fat: 0.4 } },\n  { fdcId: 5, name: \"Broccoli (1 cup)\", brandName: null, dataType: \"Generic\", macros: { calories: 55, protein: 3.7, carbs: 11, fat: 0.6 } },\n  { fdcId: 6, name: \"Salmon (100g)\", brandName: null, dataType: \"Generic\", macros: { calories: 208, protein: 20, carbs: 0, fat: 13 } },\n  { fdcId: 7, name: \"Oats (1 cup cooked)\", brandName: null, dataType: \"Generic\", macros: { calories: 150, protein: 5, carbs: 27, fat: 3 } },\n  { fdcId: 8, name: \"Greek Yogurt (1 cup)\", brandName: null, dataType: \"Generic\", macros: { calories: 130, protein: 23, carbs: 7, fat: 0 } },\n  { fdcId: 9, name: \"Almonds (1 oz)\", brandName: null, dataType: \"Generic\", macros: { calories: 164, protein: 6, carbs: 6, fat: 14 } },\n  { fdcId: 10, name: \"Egg (1 large)\", brandName: null, dataType: \"Generic\", macros: { calories: 78, protein: 6, carbs: 0.6, fat: 5 } },\n];\n\nexport async function GET(request) {\n  try {\n    const { searchParams } = new URL(request.url);\n\n    const query = searchParams.get(\"q\")?.trim().toLowerCase() || \"\";\n    const page = Number(searchParams.get(\"page\")) || 1;\n    const limit = Number(searchParams.get(\"limit\")) || 25;\n\n    if (!query) {\n      return NextResponse.json({\n        results: [],\n        page,\n      total: 0,\n    });\n  }\n\n  let foods = [];\n  try {\n    // SQLite doesn't support full-text search without extensions\n    // but LIKE + wildcard search is still fast for your use case\n    foods = await prisma.food.findMany({\n      where: {\n        OR: [\n          { description: { contains: query } },\n          { brandName:   { contains: query } },\n        ],\n      },\n      skip: (page - 1) * limit,\n      take: limit,\n    });\n  } catch (err) {\n    // Likely schema/table missing during setup â€” handled below with fallback\n    console.warn(\"DB food search unavailable, using fallback data.\", err?.message);\n  }\n\n  // Pull the food IDs returned in this page\n  const foodIds = foods.map((f) => f.fdcId);\n\n  // If DB search returned nothing, use the small fallback dataset\n  if (foodIds.length === 0 && foods.length === 0) {\n    const filtered = FALLBACK_FOODS.filter((f) =>\n      f.name.toLowerCase().includes(query)\n    ).slice(0, limit);\n    return NextResponse.json({\n      results: filtered,\n      page,\n      total: filtered.length,\n    });\n  }\n\n  // Fetch nutrients for ONLY the foods in the current page\n  const nutrientRows = await prisma.foodNutrient.findMany({\n    where: {\n      foodId: { in: foodIds },\n        nutrientId: { in: Object.values(NUTRIENTS) },\n      },\n      include: {\n        nutrient: true,\n      },\n    });\n\n    // Build macro map: fdcId -> { macros }\n    const macroMap = {};\n    for (const row of nutrientRows) {\n      const fid = row.foodId;\n      if (!macroMap[fid]) {\n        macroMap[fid] = {\n          calories: 0,\n          protein: 0,\n          carbs: 0,\n          fat: 0,\n        };\n      }\n\n      const n = row.nutrientId;\n      if (n === NUTRIENTS.calories) macroMap[fid].calories = row.amount;\n      if (n === NUTRIENTS.protein)  macroMap[fid].protein = row.amount;\n      if (n === NUTRIENTS.carbs)    macroMap[fid].carbs = row.amount;\n      if (n === NUTRIENTS.fat)      macroMap[fid].fat = row.amount;\n    }\n\n    // Build final result array\n    const results = foods.map((food) => ({\n      fdcId: food.fdcId,\n      name: food.description,\n      brandName: food.brandName,\n      dataType: food.dataType,\n      macros: macroMap[food.fdcId] || {\n        calories: 0,\n        protein: 0,\n        carbs: 0,\n        fat: 0,\n      },\n    }));\n\n    return NextResponse.json({\n      results,\n      page,\n      total: results.length,\n    });\n\n  } catch (err) {\n    console.error(\"Food search error:\", err);\n    return NextResponse.json(\n      { error: \"Failed to search foods\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}