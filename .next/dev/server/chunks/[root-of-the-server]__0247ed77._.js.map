{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/joachimjohnson/Documents/comp-sci/ZeroFlow/lib/prisma.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nlet prisma;\n\n// Prevent multiple Prisma instances in dev (Next.js hot reload)\nif (process.env.NODE_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!global.prisma) {\n    global.prisma = new PrismaClient();\n  }\n  prisma = global.prisma;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI;AAEJ,gEAAgE;AAChE;;KAEO;IACL,IAAI,CAAC,yDAAO,MAAM,EAAE;QAClB,yDAAO,MAAM,GAAG,IAAI,6IAAY;IAClC;IACA,SAAS,yDAAO,MAAM;AACxB"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/joachimjohnson/Documents/comp-sci/ZeroFlow/app/api/summary/route.js"],"sourcesContent":["// app/api/summary/route.js\n// Returns a real daily summary (calories + macros + foods) for the most recent user.\n\nimport { NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\n\nfunction getTodayRange() {\n  const start = new Date();\n  start.setHours(0, 0, 0, 0);\n  const end = new Date();\n  end.setHours(23, 59, 59, 999);\n  return { start, end };\n}\n\nfunction calculateTarget(user) {\n  if (!user) return 0;\n\n  const isMetric = user.unitSystem === \"metric\";\n  const weightKg = isMetric ? user.weight : user.weight / 2.20462;\n  const heightCm = isMetric ? user.height : user.height * 2.54;\n  const age = user.age ?? 30;\n  const sexAdj = user.sex === \"female\" ? -161 : 5;\n\n  const bmr = 10 * weightKg + 6.25 * heightCm - 5 * age + sexAdj;\n\n  const activityFactor = {\n    sedentary: 1.2,\n    light: 1.375,\n    moderate: 1.55,\n    high: 1.725,\n  }[user.activityLevel] ?? 1.2;\n\n  const goalAdj = {\n    lose: -400,\n    maintain: 0,\n    gain: 400,\n    performance: 200,\n  }[user.goal] ?? 0;\n\n  return Math.max(1200, Math.round(bmr * activityFactor + goalAdj));\n}\n\nexport async function GET() {\n  try {\n    const activeUser = await prisma.user.findFirst({\n      orderBy: { id: \"desc\" },\n    });\n\n    if (!activeUser) {\n      return NextResponse.json(\n        { error: \"No users found. Please register first.\" },\n        { status: 404 }\n      );\n    }\n\n    const { start, end } = getTodayRange();\n\n    const logs = await prisma.dailyFoodLog.findMany({\n      where: {\n        userId: activeUser.id,\n        date: {\n          gte: start,\n          lte: end,\n        },\n      },\n    });\n\n    const totals = logs.reduce(\n      (acc, item) => {\n        acc.calories += item.calories;\n        acc.protein += item.protein;\n        acc.carbs += item.carbs;\n        acc.fat += item.fat;\n        return acc;\n      },\n      { calories: 0, protein: 0, carbs: 0, fat: 0 }\n    );\n\n    const caloriesTarget = calculateTarget(activeUser);\n\n    return NextResponse.json(\n      {\n        user: {\n          id: activeUser.id,\n          firstName: activeUser.firstName,\n          preferredName: activeUser.preferredName,\n        },\n        caloriesTarget,\n        caloriesConsumed: totals.calories,\n        macros: {\n          protein: totals.protein,\n          carbs: totals.carbs,\n          fat: totals.fat,\n        },\n        workouts: [], // workouts not yet implemented\n        foods: logs.map((item) => ({\n          id: item.id,\n          name: item.name,\n          calories: item.calories,\n          protein: item.protein,\n          carbs: item.carbs,\n          fat: item.fat,\n          quantity: item.quantity,\n        })),\n      },\n      { status: 200 }\n    );\n  } catch (err) {\n    console.error(\"Summary API error:\", err);\n    return NextResponse.json({ error: \"Failed to load summary\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"AAAA,2BAA2B;AAC3B,qFAAqF;;;;;AAErF;AACA;;;AAEA,SAAS;IACP,MAAM,QAAQ,IAAI;IAClB,MAAM,QAAQ,CAAC,GAAG,GAAG,GAAG;IACxB,MAAM,MAAM,IAAI;IAChB,IAAI,QAAQ,CAAC,IAAI,IAAI,IAAI;IACzB,OAAO;QAAE;QAAO;IAAI;AACtB;AAEA,SAAS,gBAAgB,IAAI;IAC3B,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,WAAW,KAAK,UAAU,KAAK;IACrC,MAAM,WAAW,WAAW,KAAK,MAAM,GAAG,KAAK,MAAM,GAAG;IACxD,MAAM,WAAW,WAAW,KAAK,MAAM,GAAG,KAAK,MAAM,GAAG;IACxD,MAAM,MAAM,KAAK,GAAG,IAAI;IACxB,MAAM,SAAS,KAAK,GAAG,KAAK,WAAW,CAAC,MAAM;IAE9C,MAAM,MAAM,KAAK,WAAW,OAAO,WAAW,IAAI,MAAM;IAExD,MAAM,iBAAiB;QACrB,WAAW;QACX,OAAO;QACP,UAAU;QACV,MAAM;IACR,CAAC,CAAC,KAAK,aAAa,CAAC,IAAI;IAEzB,MAAM,UAAU;QACd,MAAM,CAAC;QACP,UAAU;QACV,MAAM;QACN,aAAa;IACf,CAAC,CAAC,KAAK,IAAI,CAAC,IAAI;IAEhB,OAAO,KAAK,GAAG,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,iBAAiB;AAC1D;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,MAAM,yHAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YAC7C,SAAS;gBAAE,IAAI;YAAO;QACxB;QAEA,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyC,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG;QAEvB,MAAM,OAAO,MAAM,yHAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;YAC9C,OAAO;gBACL,QAAQ,WAAW,EAAE;gBACrB,MAAM;oBACJ,KAAK;oBACL,KAAK;gBACP;YACF;QACF;QAEA,MAAM,SAAS,KAAK,MAAM,CACxB,CAAC,KAAK;YACJ,IAAI,QAAQ,IAAI,KAAK,QAAQ;YAC7B,IAAI,OAAO,IAAI,KAAK,OAAO;YAC3B,IAAI,KAAK,IAAI,KAAK,KAAK;YACvB,IAAI,GAAG,IAAI,KAAK,GAAG;YACnB,OAAO;QACT,GACA;YAAE,UAAU;YAAG,SAAS;YAAG,OAAO;YAAG,KAAK;QAAE;QAG9C,MAAM,iBAAiB,gBAAgB;QAEvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM;gBACJ,IAAI,WAAW,EAAE;gBACjB,WAAW,WAAW,SAAS;gBAC/B,eAAe,WAAW,aAAa;YACzC;YACA;YACA,kBAAkB,OAAO,QAAQ;YACjC,QAAQ;gBACN,SAAS,OAAO,OAAO;gBACvB,OAAO,OAAO,KAAK;gBACnB,KAAK,OAAO,GAAG;YACjB;YACA,UAAU,EAAE;YACZ,OAAO,KAAK,GAAG,CAAC,CAAC,OAAS,CAAC;oBACzB,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI;oBACf,UAAU,KAAK,QAAQ;oBACvB,SAAS,KAAK,OAAO;oBACrB,OAAO,KAAK,KAAK;oBACjB,KAAK,KAAK,GAAG;oBACb,UAAU,KAAK,QAAQ;gBACzB,CAAC;QACH,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}